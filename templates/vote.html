<!DOCTYPE html>
<html>
<head>
    <title>Cast Vote</title>
    <script>
        const candidates = JSON.parse('{{ all_candidates | tojson | safe }}');
        function updateCandidates() {
            const listId = document.getElementById("list").value;
            const candidates = JSON.parse('{{ all_candidates | tojson | safe }}');
            const candidateSelect = document.getElementById("candidate");

            // Clear previous options
            candidateSelect.innerHTML = "";

            // Filter and add new options
            candidates.forEach(candidate => {
                if (candidate.candidate_list_id == listId) {
                    const option = document.createElement("option");
                    option.value = candidate.id;
                    option.textContent = candidate.name + " (" + candidate.party + ")";
                    candidateSelect.appendChild(option);
                }
            });
        }
    </script>
</head>
<body>
    <h2>Cast Your Vote</h2>

    <form method="POST">
        <label>Select a List:
            <select name="list_id" id="list" onchange="updateCandidates()" required>
                <option value="">-- Select List --</option>
                {% for clist in candidate_lists %}
                    <option value="{{ clist.id }}">{{ clist.name }}</option>
                {% endfor %}
            </select>
        </label>
        <br><br>

        <label>Select a Candidate:
            <select name="candidate_id" id="candidate" required>
                <!-- Populated by JavaScript -->
            </select>
        </label>
        <br><br>

        <button type="submit">Submit Vote</button>
    </form>

    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% elif success %}
        <p style="color:green;">{{ success }}</p>
    {% endif %}
</body>
</html>
